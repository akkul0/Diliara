<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>I WILL EAT YOU üêç</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f2027">
    <meta name="mobile-web-app-capable" content="yes">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Snake Game">
    <link rel="apple-touch-icon" href="icon.png"> 

    <style>
        body {
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            color: white; overflow: hidden; touch-action: none; /* Kaydƒ±rmayƒ± engelle */
            -webkit-user-select: none; user-select: none; /* Metin se√ßimini engelle */
        }
        canvas {
            border: 4px solid #fff;
            border-radius: 12px;
            box-shadow: 0 0 50px rgba(0,0,0,0.6);
            background: #000;
            max-width: 95vw; /* Mobilde ta≈ümasƒ±n */
            /* DEƒûƒ∞≈ûƒ∞KLƒ∞K: Mobilde tu≈ülara yer kalsƒ±n diye y√ºksekliƒüi azalttƒ±k */
            max-height: 55vh; 
        }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; z-index: 10; }
        
        #scoreBoard {
            display: flex; justify-content: center; gap: 20px;
            text-shadow: 2px 2px 0 #000;
        }
        .score-box { font-size: 20px; font-weight: bold; color: #fff; } 
        #scoreVal { color: #ffd700; font-size: 28px; }
        #highScoreVal { color: #00ff00; }

        /* --- MEN√ú --- */
        #menuScreen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 20; backdrop-filter: blur(8px);
        }
        h1 {
            font-size: 32px; color: #ff4757; text-transform: uppercase; 
            margin-bottom: 20px; text-shadow: 0 0 20px rgba(255, 71, 87, 0.5);
            letter-spacing: 2px; text-align: center; line-height: 1.2;
        }
        .menu-section { margin-bottom: 15px; text-align: center; width: 100%; }
        .label { font-size: 14px; margin-bottom: 8px; color: #ccc; letter-spacing: 1px; }
        
        .lang-container { display: flex; gap: 10px; justify-content: center; margin-bottom: 10px; }
        .lang-btn {
            background: transparent; border: 2px solid #555; color: #888;
            padding: 8px 12px; font-weight: bold; cursor: pointer; 
            border-radius: 5px; transition: 0.3s;
        }
        .lang-btn.active { border-color: #ffd700; color: #ffd700; box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }

        .skin-container { display: flex; gap: 15px; justify-content: center; }
        .skin-btn {
            width: 45px; height: 45px; border-radius: 50%; border: 3px solid transparent;
            cursor: pointer; transition: transform 0.2s, border-color 0.2s; position: relative;
        }
        .skin-btn.selected { border-color: #fff; transform: scale(1.1); box-shadow: 0 0 15px rgba(255,255,255,0.5); }
        .skin-green { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .skin-blue { background: linear-gradient(135deg, #3498db, #2980b9); }
        .skin-purple { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .skin-red { background: linear-gradient(135deg, #e74c3c, #c0392b); }

        input[type=range] { width: 200px; accent-color: #ff4757; cursor: pointer; }

        #startBtn {
            background: linear-gradient(45deg, #ff4757, #ff6b81);
            color: white; border: none; padding: 15px 40px;
            font-size: 24px; font-weight: bold; border-radius: 50px;
            cursor: pointer; box-shadow: 0 10px 30px rgba(255, 71, 87, 0.4);
            transition: transform 0.1s, box-shadow 0.1s; margin-top: 10px;
        }
        #startBtn:active { transform: scale(0.95); }

        #gameOver { pointer-events: auto; margin-top: 10px; z-index: 15; }
        .restart-btn {
            background: #fff; color: #333; border: none; padding: 10px 25px;
            font-size: 18px; font-weight: bold; border-radius: 30px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); transition: 0.2s;
        }

        /* MOBƒ∞L KONTROLLER */
        /* DEƒûƒ∞≈ûƒ∞KLƒ∞K: Gap arttƒ±rƒ±ldƒ± ve konum biraz daha yukarƒ± √ßekildi */
        #controls { 
            display: grid; 
            grid-template-areas: ". up ." "left . right" ". down ."; 
            gap: 15px; 
            position: absolute; 
            bottom: 30px; 
            z-index: 5; 
        }
        
        .d-pad-btn {
            /* DEƒûƒ∞≈ûƒ∞KLƒ∞K: Tu≈ü boyutlarƒ± 60px -> 80px */
            width: 80px; 
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            /* DEƒûƒ∞≈ûƒ∞KLƒ∞K: Font boyutu b√ºy√ºt√ºld√º */
            font-size: 32px; 
            user-select: none; backdrop-filter: blur(4px);
            touch-action: manipulation;
        }
        .d-pad-btn:active { background: rgba(255,255,255,0.3); }
        #btnUp { grid-area: up; }
        #btnDown { grid-area: down; }
        #btnLeft { grid-area: left; }
        #btnRight { grid-area: right; }

        /* Masa√ºst√ºnde (mouse varsa) kontrolleri gizle */
        @media (pointer: fine) { 
            #controls { display: none; } 
            canvas { max-height: 75vh; } /* Masa√ºst√ºnde canvas daha b√ºy√ºk olabilir */
        }
    </style>
</head>
<body>

    <div id="ui">
        <div id="scoreBoard">
            <div class="score-box"><span id="uiScoreLabel">SCORE</span>: <span id="scoreVal">0</span></div>
            <div class="score-box"><span id="uiHighLabel">BEST</span>: <span id="highScoreVal">0</span></div>
        </div>
        <div id="gameOver"></div>
    </div>

    <div id="menuScreen">
        <h1>I WILL EAT YOU üêç</h1>
        <div class="menu-section">
            <div class="lang-container">
                <button class="lang-btn" id="lang-en" onclick="changeLanguage('en')">EN</button>
                <button class="lang-btn" id="lang-tr" onclick="changeLanguage('tr')">TR</button>
                <button class="lang-btn" id="lang-ru" onclick="changeLanguage('ru')">RU</button>
            </div>
        </div>
        <div class="menu-section">
            <div class="label" id="lblSkin">TAIL COLOR</div>
            <div class="skin-container">
                <div class="skin-btn skin-green selected" onclick="selectSkin('green')"></div>
                <div class="skin-btn skin-blue" onclick="selectSkin('blue')"></div>
                <div class="skin-btn skin-purple" onclick="selectSkin('purple')"></div>
                <div class="skin-btn skin-red" onclick="selectSkin('red')"></div>
            </div>
        </div>
        <div class="menu-section">
            <div class="label" id="lblVolume">VOLUME</div>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.3">
        </div>
        <button id="startBtn" onclick="startGameFromMenu()">PLAY</button>
    </div>

    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <div id="controls">
        <div class="d-pad-btn" id="btnUp">‚Üë</div>
        <div class="d-pad-btn" id="btnLeft">‚Üê</div>
        <div class="d-pad-btn" id="btnRight">‚Üí</div>
        <div class="d-pad-btn" id="btnDown">‚Üì</div>
    </div>

    <script>
        // PWA SERVICE WORKER KAYDI
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker kayƒ±tlƒ±!', reg))
                    .catch(err => console.log('SW Hata:', err));
            });
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        // DEƒûƒ∞≈ûƒ∞KLƒ∞K: Hƒ±z 210 ms yapƒ±ldƒ±
        const gridSize = 10; const cellSize = 40; const moveInterval = 210; 
        
        const langData = {
            en: { skin: "TAIL COLOR", volume: "VOLUME", play: "PLAY", score: "SCORE", best: "BEST", restart: "REPLAY üíÄ", menu: "MENU üè†" },
            tr: { skin: "KUYRUK RENGƒ∞", volume: "SES SEVƒ∞YESƒ∞", play: "OYNA", score: "SKOR", best: "REKOR", restart: "TEKRAR üíÄ", menu: "MEN√ú üè†" },
            ru: { skin: "–¶–í–ï–¢ –•–í–û–°–¢–ê", volume: "–ì–†–û–ú–ö–û–°–¢–¨", play: "–ò–ì–†–ê–¢–¨", score: "–°–ß–Å–¢", best: "–†–ï–ö–û–†–î", restart: "–ó–ê–ù–û–í–û üíÄ", menu: "–ú–ï–ù–Æ üè†" }
        };
        let currentLang = 'ru'; 

        const images = { head: new Image(), open: new Image(), food: new Image(), grass: new Image() };
        images.head.src = 'https://i.imgur.com/IPByPE6.jpeg'; 
        images.open.src = 'https://i.imgur.com/cDsbEMV.jpeg'; 
        images.food.src = 'https://i.imgur.com/IAI6oAT.png'; 
        images.grass.src = 'https://opengameart.org/sites/default/files/grass_14.png';

        const skins = {
            green:  { c1: '#2ecc71', c2: '#27ae60', bg: '#1e8449' },
            blue:   { c1: '#3498db', c2: '#2980b9', bg: '#1a5276' },
            purple: { c1: '#9b59b6', c2: '#8e44ad', bg: '#6c3483' },
            red:    { c1: '#e74c3c', c2: '#c0392b', bg: '#922b21' }
        };
        let currentSkin = 'green'; 
        const biteSound = new Audio('https://www.orangefreesounds.com/wp-content/uploads/2014/11/Apple-bite.mp3');
        const bgMusic = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3');
        bgMusic.loop = true; let globalVolume = 0.3;
        
        document.getElementById('volumeSlider').addEventListener('input', (e) => { globalVolume = e.target.value; bgMusic.volume = globalVolume; });
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playCrashSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(150, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            gain.gain.setValueAtTime(globalVolume, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.5);
        }

        let snake = []; let particles = []; let floatingTexts = []; let direction = {x: 1, y: 0}; let inputQueue = [];
        let food = { x:0, y:0, isGold: false }; let score = 0; let highScore = localStorage.getItem('snakeHighScore') || 0;
        let lastMoveTime = 0; let gameRunning = false; let shakeIntensity = 0;
        document.getElementById('highScoreVal').innerText = highScore;

        function changeLanguage(lang) {
            currentLang = lang; const data = langData[lang];
            document.getElementById('lblSkin').innerText = data.skin; document.getElementById('lblVolume').innerText = data.volume;
            document.getElementById('startBtn').innerText = data.play; document.getElementById('uiScoreLabel').innerText = data.score;
            document.getElementById('uiHighLabel').innerText = data.best;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active')); document.getElementById(`lang-${lang}`).classList.add('active');
        }
        changeLanguage(currentLang);
        function selectSkin(skinName) { currentSkin = skinName; document.querySelectorAll('.skin-btn').forEach(btn => btn.classList.remove('selected')); document.querySelector(`.skin-${skinName}`).classList.add('selected'); }
        function startGameFromMenu() { document.getElementById('menuScreen').style.display = 'none'; initGame(); }
        function showMenu() { gameRunning = false; document.getElementById('menuScreen').style.display = 'flex'; document.getElementById('gameOver').innerHTML = ''; bgMusic.pause(); bgMusic.currentTime = 0; }
        
        function initGame() {
            if (gameRunning) return;
            bgMusic.volume = globalVolume; bgMusic.play().catch(() => {});
            snake = [{x: 5, y: 5, px: 5, py: 5}, {x: 4, y: 5, px: 4, py: 5}, {x: 3, y: 5, px: 3, py: 5}];
            direction = {x: 1, y: 0}; inputQueue = []; score = 0; particles = []; floatingTexts = []; gameRunning = true; shakeIntensity = 0;
            document.getElementById('scoreVal').innerText = score; document.getElementById('gameOver').innerHTML = '';
            spawnFood(); lastMoveTime = performance.now(); requestAnimationFrame(gameLoop);
        }

        function addShake(amount) { shakeIntensity = amount; }
        function createFloatingText(x, y, text, color='#ffd700') { floatingTexts.push({x: x*cellSize+cellSize/2, y: y*cellSize, text:text, life:1.0, vy:-2, color:color}); }
        function createParticles(x, y, isGold) {
            const colors = isGold ? ['#FFD700', '#FFA500', '#FFFFE0'] : ['#ffeb3b', '#ff5722', '#4caf50', '#00bcd4', '#e91e63'];
            let count = isGold ? 20 : 12;
            for (let i=0; i<count; i++) { particles.push({x:x*cellSize+cellSize/2, y:y*cellSize+cellSize/2, vx:(Math.random()-0.5)*12, vy:(Math.random()-0.5)*12, life:1.0, color:colors[Math.floor(Math.random()*colors.length)], size:Math.random()*6+2}); }
        }
        function updateEffects() {
            if (shakeIntensity > 0) shakeIntensity *= 0.9; if (shakeIntensity < 0.5) shakeIntensity = 0;
            for (let i=particles.length-1; i>=0; i--) { let p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.life-=0.05; p.size*=0.95; if(p.life<=0) particles.splice(i,1); }
            for (let i=floatingTexts.length-1; i>=0; i--) { let t=floatingTexts[i]; t.y+=t.vy; t.life-=0.02; if(t.life<=0) floatingTexts.splice(i,1); }
        }
        function update() {
            if (inputQueue.length > 0) {
                let nextDir = inputQueue.shift();
                if ((nextDir.x !== 0 && nextDir.x !== -direction.x) || (nextDir.y !== 0 && nextDir.y !== -direction.y)) direction = nextDir;
            }
            const headX = snake[0].x + direction.x; const headY = snake[0].y + direction.y;
            if (headX < 0 || headX >= gridSize || headY < 0 || headY >= gridSize || snake.some(s => s.x === headX && s.y === headY)) { 
                for (let i = 0; i < snake.length; i++) { snake[i].px = snake[i].x; snake[i].py = snake[i].y; }
                const oldHead = snake[0]; snake.unshift({ x: headX, y: headY, px: oldHead.x, py: oldHead.y });
                playCrashSound(); addShake(20); gameOver(); return; 
            }
            for (let i = 0; i < snake.length; i++) { snake[i].px = snake[i].x; snake[i].py = snake[i].y; }
            if (headX === food.x && headY === food.y) {
                let points = food.isGold ? 5 : 1; score += points;
                createParticles(headX, headY, food.isGold); createFloatingText(headX, headY, "+" + points, food.isGold ? '#FFD700' : '#FFF'); addShake(food.isGold ? 10 : 5);
                document.getElementById('scoreVal').innerText = score; biteSound.volume = globalVolume; biteSound.currentTime = 0; biteSound.play(); 
                snake.unshift({x: headX, y: headY, px: snake[0].x, py: snake[0].y}); spawnFood();
            } else {
                snake.unshift({ x: headX, y: headY, px: snake[0].x, py: snake[0].y }); snake.pop(); 
            }
        }
        function spawnFood() {
            let valid = false;
            while (!valid) { food.x = Math.floor(Math.random() * gridSize); food.y = Math.floor(Math.random() * gridSize); valid = !snake.some(s => s.x === food.x && s.y === food.y); }
            food.isGold = Math.random() < 0.2;
        }
        function draw(interpolation, time) {
            ctx.save();
            if (shakeIntensity > 0) ctx.translate((Math.random()-0.5)*shakeIntensity, (Math.random()-0.5)*shakeIntensity);
            ctx.imageSmoothingEnabled = true; 
            if (images.grass.complete && images.grass.naturalWidth !== 0) { ctx.fillStyle = ctx.createPattern(images.grass, 'repeat'); ctx.fillRect(-10, -10, canvas.width+20, canvas.height+20); } else { ctx.fillStyle = '#2d3436'; ctx.fillRect(0,0, canvas.width, canvas.height); }
            let pulse = 1 + Math.sin(time / (food.isGold ? 100 : 200)) * (food.isGold ? 0.2 : 0.1); 
            let fx = food.x*cellSize+cellSize/2; let fy = food.y*cellSize+cellSize/2; let fSize = cellSize*pulse;
            ctx.save(); 
            if (food.isGold) { ctx.filter = 'sepia(100%) saturate(500%) brightness(120%) hue-rotate(10deg)'; ctx.shadowColor = '#FFD700'; ctx.shadowBlur = 20; }
            if (images.food.complete && images.food.naturalWidth !== 0) { ctx.drawImage(images.food, fx - fSize/2, fy - fSize/2, fSize, fSize); } else { ctx.fillStyle = food.isGold ? '#FFD700' : '#ff7675'; ctx.beginPath(); ctx.arc(fx, fy, (cellSize/2)*pulse, 0, Math.PI*2); ctx.fill(); }
            ctx.restore(); 
            for (let i = 1; i < snake.length; i++) { let s = snake[i]; let pixelX = (s.px + (s.x - s.px) * interpolation) * cellSize; let pixelY = (s.py + (s.y - s.py) * interpolation) * cellSize; drawPixelBody(ctx, pixelX, pixelY, cellSize, i === snake.length -1); }
            if (snake.length > 0) {
                let h = snake[0]; let headPixelX = (h.px + (h.x - h.px) * interpolation) * cellSize; let headPixelY = (h.py + (h.y - h.py) * interpolation) * cellSize;
                if (!gameRunning) { headPixelX = h.x * cellSize; headPixelY = h.y * cellSize; }
                const dist = Math.abs(h.x - food.x) + Math.abs(h.y - food.y); let currentHeadImg = (dist <= 1) ? images.open : images.head;
                if (currentHeadImg.complete && currentHeadImg.naturalWidth !== 0) { ctx.drawImage(currentHeadImg, headPixelX, headPixelY, cellSize, cellSize); } else { ctx.fillStyle = '#0984e3'; ctx.fillRect(headPixelX, headPixelY, cellSize, cellSize); ctx.fillStyle = 'white'; ctx.fillRect(headPixelX+10, headPixelY+10, 5, 5); }
            }
            for (let p of particles) { ctx.globalAlpha = p.life; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill(); }
            ctx.globalAlpha = 1.0; ctx.font = "bold 24px Arial"; ctx.textAlign = "center";
            for (let t of floatingTexts) { ctx.globalAlpha = t.life; ctx.fillStyle = t.color; ctx.strokeStyle = 'black'; ctx.lineWidth = 3; ctx.strokeText(t.text, t.x, t.y); ctx.fillText(t.text, t.x, t.y); }
            ctx.globalAlpha = 1.0; ctx.restore();
        }
        function drawPixelBody(ctx, x, y, size, isTail) {
            const palette = skins[currentSkin]; ctx.fillStyle = palette.bg; ctx.fillRect(x, y, size, size);
            const p = 4; ctx.fillStyle = palette.c1; ctx.fillRect(x + p, y + p, size - p*2, size - p*2);
            ctx.fillStyle = palette.c2; const s = size/4; ctx.fillRect(x+p+s, y+p, s, s); ctx.fillRect(x+p+s*2, y+p+s, s, s); ctx.fillRect(x+p, y+p+s*2, s, s); ctx.fillRect(x+p+s*2, y+p+s*2, s, s);
        }
        function gameOver() {
            gameRunning = false;
            if (score > highScore) { highScore = score; localStorage.setItem('snakeHighScore', highScore); document.getElementById('highScoreVal').innerText = highScore; }
            draw(1, performance.now()); 
            const txt = langData[currentLang];
            document.getElementById('gameOver').innerHTML = `<div style="display:flex; gap:10px; justify-content:center;"><button class="restart-btn" onclick="initGame()">${txt.restart}</button><button class="restart-btn" onclick="showMenu()">${txt.menu}</button></div>`;
        }
        function gameLoop(currentTime) {
            if (!gameRunning) return;
            updateEffects();
            const timeSinceLastMove = currentTime - lastMoveTime;
            if (timeSinceLastMove > moveInterval) { lastMoveTime = currentTime; update(); }
            const interpolation = Math.min((currentTime - lastMoveTime) / moveInterval, 1);
            draw(interpolation, currentTime);
            requestAnimationFrame(gameLoop);
        }
        window.addEventListener('keydown', e => {
            const key = e.key.toLowerCase(); let newDir = null;
            if ((key === 'w' || key === 'arrowup')) newDir = {x: 0, y: -1}; if ((key === 's' || key === 'arrowdown')) newDir = {x: 0, y: 1};
            if ((key === 'a' || key === 'arrowleft')) newDir = {x: -1, y: 0}; if ((key === 'd' || key === 'arrowright')) newDir = {x: 1, y: 0};
            if (newDir && inputQueue.length < 2) inputQueue.push(newDir);
        });
        const addTouch = (dx, dy) => { if(inputQueue.length < 2) inputQueue.push({x:dx, y:dy}); };
        document.getElementById('btnUp').addEventListener('touchstart', (e)=>{e.preventDefault(); addTouch(0,-1)}); document.getElementById('btnDown').addEventListener('touchstart', (e)=>{e.preventDefault(); addTouch(0,1)});
        document.getElementById('btnLeft').addEventListener('touchstart', (e)=>{e.preventDefault(); addTouch(-1,0)}); document.getElementById('btnRight').addEventListener('touchstart', (e)=>{e.preventDefault(); addTouch(1,0)});
    </script>
</body>
</html>
